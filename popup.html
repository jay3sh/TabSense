<html>
<head>
<style>
body {
  min-width:357px;
  overflow-x:hidden;
}

img {
  margin:5px;
  border:2px solid black;
  vertical-align:middle;
  width:75px;
  height:75px;
}
</style>

<script type="text/javascript" src="scripts/jquery-1.4.2.min.js"></script>

<script>
$(document).ready(function(){
    /*
    var curtab = window.localStorage.getItem('currentTab');
    var curwin = window.localStorage.getItem('currentWindow');

    var elem = document.createElement('li');
    elem.innerHTML = '<i> JQ CUR TAB '+curtab+'</i>';
    document.body.appendChild(elem);

    var elem = document.createElement('li');
    elem.innerHTML = '<i> JQ CUR WINDOW '+curwin+'</i>';
    document.body.appendChild(elem);

    chrome.tabs.captureVisibleTab(null, null, function(dataUrl) {
        var img = $('<img/>');
        img.attr('src', dataUrl);
        $('body').append(img);
    });
    */

    chrome.windows.getAll(null, 
        function(windows) {
            var wl = windows.length;
            for(var i=0; i < wl; i++) {
                var tabs = chrome.tabs.getAllInWindow(windows[i].id,
                    function(tabs) {
                        var tl = tabs.length;
                        for(var j=0; j < tl; j++) {
                            var tab = tabs[j];
                            var wid = tab.windowId
                            var tid = tab.id;
                            var dataUrl = window.localStorage.getItem(
                                'tabsense_capture_'+tid+':'+wid);
                            if(dataUrl) {
                                var img = $('<img/>');
                                img.attr('src', dataUrl);
                                $('body').append(img);
                            } else {
                                $('body').append('<i>'+tab.title+'</i>');
                            }
                        }
                    }
                );
            }
        }
    );
    
});
/*
chrome.windows.getAll(null, 
    function(windows) {



        for(var i=0; i <windows.length; i++) {
            var elem = document.createElement('ul');
            elem.innerHTML = '<b>'+windows[i].id+'</b>';
            document.body.appendChild(elem);

            var tabs = chrome.tabs.getAllInWindow(windows[i].id,
                function(tabs) {
                    if(tabs) {
                        for(var j=0; j < tabs.length; j++) {
                            var elem = document.createElement('li');
                            elem.innerHTML = '<i>'+tabs[j].windowId+':'+tabs[j].id+']'+
                                            tabs[j].title+'</i>';

                            document.body.appendChild(elem);
                        }
                    } else {
                        var elem = document.createElement('li');
                        elem.innerHTML = '<i>undefined</i>';
                        document.body.appendChild(elem);
                    }
                }
            );
        }
    }
);
*/
</script>
</head>
<body>
</body>
</html>
